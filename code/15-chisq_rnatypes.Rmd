---
title: "chi square for RNA types"
author: "Megan Ewing"
date: "2025-01-30"
output: html_document
---

```{r}
# install.packages("dplyr")
# install.packages("tidyverse")
# install.packages("cowplot")
# install.packages("ggpubr")
# install.packages("rstatix")
#packages
  library(dplyr)
  library(tidyverse)
  library(tidyr)
  library(data.table)
  library(ggplot2)
  library(RColorBrewer)
  library(cowplot)
  library(ggpubr)
  library(rstatix)
```

```{r}
#read in the count table from STAR (or DESEq2)<-ask Giles
#note: in BBEdit I replaced the "Type" information: replaced "protein-coding" with "mito" for the first 13 genes 
#which are the mitochondrial genes

counts<- read.csv("../data/chisq_rnatypes/count_data_mitoedit.csv")
head(counts)

```

## T Tests

```{r}
# Identify control and treatment columns
control_cols <- c("M.C.193", "M.C.216", "M.C.218", "M.C.226", "M.C.306", "M.C.329", 
                  "M.C.334", "M.C.337", "M.C.339", "M.C.358", "M.C.360", "M.C.363", 
                  "M.C.373", "M.C.482", "M.C.488")
control_cols #peek

treatment_cols <- c("M.T.18", "M.T.20", "M.T.22", "M.T.235", "M.T.245", "M.T.31", 
                    "M.T.32", "M.T.399", "M.T.43", "M.T.44", "M.T.500", "M.T.7", 
                    "M.T.8", "M.T.83", "M.T.29")

treatment_cols  #peek
```

Separate dataframes for each gene type

```{r}

# Subset the data for each gene type
mito_df <- counts %>% filter(Type == "mito")
head(mito_df)

tRNA_df <- counts %>% filter(Type == "tRNA")
head(tRNA_df)

protein_df <- counts %>% filter(Type == "protein_coding")
head(protein_df)

lncRNA_df <- counts %>% filter(Type == "lncRNA")
head(lncRNA_df)

rRNA_df <- counts %>% filter(Type =="rRNA")
head(rRNA_df)

snRNA_df <- counts %>% filter(Type =="snRNA")
head(snRNA_df)

snoRNA_df <- counts %>% filter(Type =="snoRNA")
head(snoRNA_df)

ncRNA_df <- counts %>% filter(Type =="ncRNA")
head(ncRNA_df)

pseudo_df <- counts %>% filter(Type =="transcribed_pseudogene")
head(pseudo_df)
```

Format for t test

```{r}
# Reshape data from wide to long format
mito_long <- mito_df %>%
  pivot_longer(cols = all_of(c(control_cols, treatment_cols)),
               names_to = "group", values_to = "count") %>%
  mutate(condition = ifelse(group %in% control_cols, "control", "treatment"))
head(mito_long)

tRNA_long <- tRNA_df %>%
  pivot_longer(cols = all_of(c(control_cols, treatment_cols)),
               names_to = "group", values_to = "count") %>%
  mutate(condition = ifelse(group %in% control_cols, "control", "treatment"))
head(tRNA_long)

protein_long <- protein_df %>%
  pivot_longer(cols = all_of(c(control_cols, treatment_cols)),
               names_to = "group", values_to = "count") %>%
  mutate(condition = ifelse(group %in% control_cols, "control", "treatment"))
head(protein_long)

lncRNA_long <- lncRNA_df %>%
  pivot_longer(cols = all_of(c(control_cols, treatment_cols)),
               names_to = "group", values_to = "count") %>%
  mutate(condition = ifelse(group %in% control_cols, "control", "treatment"))
head(lncRNA_long) 
        
rRNA_long <- rRNA_df %>%
  pivot_longer(cols = all_of(c(control_cols, treatment_cols)),
               names_to = "group", values_to = "count") %>%
  mutate(condition = ifelse(group %in% control_cols, "control", "treatment"))
head(rRNA_long)

snRNA_long <- snRNA_df %>%
  pivot_longer(cols = all_of(c(control_cols, treatment_cols)),
               names_to = "group", values_to = "count") %>%
  mutate(condition = ifelse(group %in% control_cols, "control", "treatment"))
head(snRNA_long)

snoRNA_long <- snoRNA_df %>%
  pivot_longer(cols = all_of(c(control_cols, treatment_cols)),
               names_to = "group", values_to = "count") %>%
  mutate(condition = ifelse(group %in% control_cols, "control", "treatment"))
head(snoRNA_long)

ncRNA_long <- ncRNA_df %>%
  pivot_longer(cols = all_of(c(control_cols, treatment_cols)),
               names_to = "group", values_to = "count") %>%
  mutate(condition = ifelse(group %in% control_cols, "control", "treatment"))
head(ncRNA_long)

pseudo_long <- pseudo_df %>%
  pivot_longer(cols = all_of(c(control_cols, treatment_cols)),
               names_to = "group", values_to = "count") %>%
  mutate(condition = ifelse(group %in% control_cols, "control", "treatment"))
head(pseudo_long)
         
```

perform t tests

```{r}
mito_ttest <- t.test(count ~ condition, data = mito_long, var.equal = FALSE)
mito_ttest

tRNA_ttest <- t.test(count ~ condition, data = tRNA_long, var.equal = FALSE)
tRNA_ttest

protein_ttest <- t.test(count ~ condition, data = protein_long, var.equal = FALSE)
protein_ttest

lncRNA_ttest <- t.test(count ~ condition, data = lncRNA_long, var.equal = FALSE)
lncRNA_ttest

rRNA_ttest <- t.test(count ~ condition, data = rRNA_long, var.equal = FALSE)
rRNA_ttest

snRNA_ttest <- t.test(count ~ condition, data = snRNA_long, var.equal = FALSE)
snRNA_ttest

snoRNA_ttest <- t.test(count ~ condition, data = snoRNA_long, var.equal = FALSE)
snoRNA_ttest

ncRNA_ttest <- t.test(count ~ condition, data = ncRNA_long, var.equal = FALSE)
ncRNA_ttest 

pseudo_ttest <- t.test(count ~ condition, data = pseudo_long, var.equal = FALSE)
pseudo_ttest

```

t test results (uncorrected)

```{r}
# Collect results into a dataframe
ttest_results <- data.frame(
  Gene_Type = c("mito", "tRNA", "protein_coding", "lncRNA", "rRNA", 
                "snRNA", "snoRNA", "ncRNA", "pseudo"),
  p_value = c(mito_ttest$p.value, tRNA_ttest$p.value, protein_ttest$p.value,
              lncRNA_ttest$p.value, rRNA_ttest$p.value, snRNA_ttest$p.value,
              snoRNA_ttest$p.value, ncRNA_ttest$p.value, pseudo_ttest$p.value),
  t_statistic = c(mito_ttest$statistic, tRNA_ttest$statistic, protein_ttest$statistic,
                  lncRNA_ttest$statistic, rRNA_ttest$statistic, snRNA_ttest$statistic,
                  snoRNA_ttest$statistic, ncRNA_ttest$statistic, pseudo_ttest$statistic)
)

# View the t-test results dataframe
print(ttest_results)

```

testing corrections

```{r}
# Apply Bonferroni correction
ttest_results$bonferroni_adjusted_p <- p.adjust(ttest_results$p_value, method = "bonferroni")

# Apply Benjamini-Hochberg correction (FDR)
ttest_results$fdr_adjusted_p <- p.adjust(ttest_results$p_value, method = "BH")

# View the results with adjusted p-values
print(ttest_results)

```

### Chi Square

```{r}
# Summarize total counts by gene type
summary_table <- counts %>%
  group_by(Type) %>%
  summarise(
    control_sum = sum(M.C.193, M.C.216, M.C.218, M.C.226, M.C.306, M.C.329, M.C.334, M.C.337, M.C.339, M.C.358, M.C.360, M.C.363, M.C.373, M.C.482, M.C.488),
    treatment_sum = sum(M.T.18, M.T.20, M.T.22, M.T.235, M.T.245, M.T.31, M.T.32, M.T.399, M.T.43, M.T.44, M.T.500, M.T.7, M.T.8, M.T.83, M.T.29)
  )

head(summary_table)
```

```{r}
# Convert to a matrix for statistical testing
contingency_table <- as.matrix(summary_table[, 2:3])
rownames(contingency_table) <- summary_table$type

# Perform Chi-square test
chi_result <- chisq.test(contingency_table)
chi_result

```

Chi Square results showed that there was a difference by gene type between control and treatment, but T test for each individual gene type (when FDR adjusted for multiple comparisons) revealed this was due to protein coding RNA types.
